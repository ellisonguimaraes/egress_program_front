@page "/admin/egressos"
@using EgressPortal.Models.Form
@using System.Net
@using EgressPortal.Models.API.HttpClient.Egress
@using EgressPortal.Models.Form.Enums
@using EgressPortal.Shared.Utils
@inject IEgressServices EgressServices
@inject ISnackbar Snackbar
<PageTitle>Página Inicial</PageTitle>

<TitlePageComponent Title="Administrador" SubTitle=""/>
<div class="d-flex flex-column align-items-center w-100 py-8 gap-8">
    <div class="d-flex justify-space-around flex-grow-1 w-100">
        <MudText Align="Align.Left" Typo="Typo.h5" Style="font-weight: bold">Egressos</MudText>
        <div class="d-flex justify-space-between gap-4">
            <MudButton Variant="Variant.Filled" Color="Color.Primary">ADICIONAR EGRESSO</MudButton>
            <MudButton Variant="Variant.Filled" Color="Color.Primary">ADICIONAR EM LOTE (CSV)</MudButton>
        </div>
    </div>

    <div class="d-flex justify-space-around flex-grow-1 flex-column">
        <EditForm Model="_egressAdminFilter" OnValidSubmit="OnValidSubmitAsync">
            <MudGrid Class="d-flex w-100 m-0 p-0 pb-3">
                <MudItem xs="12" sm="12" md="4" lg="3" Class="m-0">
                    <MudTextField Variant="Variant.Outlined"
                                  Margin="Margin.Dense"
                                  Class="p-0 m-0"
                                  Placeholder="John Doe"
                                  Label="Nome"
                                  @bind-Value="_egressAdminFilter.Name"
                                  For="@(() => _egressAdminFilter.Name)"/>
                </MudItem>
                <MudItem xs="12" sm="12" md="4" lg="3" Class="m-0">
                    <MudTextField Variant="Variant.Outlined"
                                  Margin="Margin.Dense"
                                  Class="p-0 m-0"
                                  Placeholder="Ciencias da Computacao"
                                  Label="Curso"
                                  @bind-Value="_egressAdminFilter.Course"
                                  For="@(() => _egressAdminFilter.Course)"/>
                </MudItem>
                <MudItem xs="12" sm="12" md="4" lg="3" Class="m-0">
                    <MudSelect T="string" Label="Ano de Ingresso"
                               Placeholder="2023.1"
                               Variant="Variant.Outlined"
                               AnchorOrigin="Origin.BottomCenter"
                               Margin="Margin.Dense"
                               Class="p-0 m-0"
                               @bind-Value="_egressAdminFilter.IngressYear"
                               For="@(() => _egressAdminFilter.IngressYear)">
                        <MudSelectItem T="string" Value="@("Todos os semestres")">Todos os semestres</MudSelectItem>
                        @foreach (var s in GenerateFinalSemestersToSelect())
                        {
                            <MudSelectItem T="string" Value="@s"/>
                        }
                    </MudSelect>
                </MudItem>
                <MudItem xs="12" sm="12" md="4" lg="3" Class="m-0">
                    <MudSelect T="string" Label="Ano de Conclusão"
                               Placeholder="2023.1"
                               Variant="Variant.Outlined"
                               Margin="Margin.Dense"
                               AnchorOrigin="Origin.BottomCenter"
                               Class="p-0 m-0"
                               @bind-Value="_egressAdminFilter.GraduationYear"
                               For="@(() => _egressAdminFilter.GraduationYear)">
                        <MudSelectItem T="string" Value="@("Todos os semestres")">Todos os semestres</MudSelectItem>
                        @foreach (var s in GenerateFinalSemestersToSelect())
                        {
                            <MudSelectItem T="string" Value="@s"/>
                        }
                    </MudSelect>
                </MudItem>
            </MudGrid>
            <div class="d-flex flex-grow-1 justify-end mr-3">
                <MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary" Class="">Filtrar</MudButton>
            </div>
        </EditForm>
    </div>

    <div class="d-flex flex-column">

    </div>
</div>

@code {

    #region Constants

    private const int PAGE_SIZE = 3;

    #endregion

    private int _totalPages = 1;
    
    private EgressAdminFilterForm _egressAdminFilter = new() { IngressYear = "Todos os semestres", GraduationYear = "Todos os semestres" };
    
    private List<GetEgressPaginateResponseApi> _egresses = new();

    private static IEnumerable<string> GenerateFinalSemestersToSelect()
    {
        var semesters = new List<string>();

        for (var i = DateTime.UtcNow.Year; i >= 1960; i--)
        {
            semesters.Add($"{i}.2");
            semesters.Add($"{i}.1");
        }

        return semesters.OrderDescending();
    }

    private async Task GetEgressPaginateAsync(int pageNumber)
    {
        // var result = await EgressServices.GetPaginateEgressAsync(pageNumber, PAGE_SIZE, _egressAdminFilter);
        //
        // if (result.StatusCode.Equals((int)HttpStatusCode.OK))
        // {
        //     _egresses = result.Data!.Data!.ToList();
        //     _totalPages = result.Data.TotalPages;
        // }
        // else
        // {
        //     foreach (var error in result.Errors)
        //     {
        //         Snackbar.Add(error, Severity.Error);
        //     }
        // }
    }

    private async Task OnValidSubmitAsync()
    {
        Console.WriteLine("Submeteu!!!");
    }

}